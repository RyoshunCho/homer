<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Phone Number Formatter</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        :root {
            --bg-color: #ffffff;
            --text-color: #202124;
            --subtext-color: #5f6368;
            --border-color: #dadce0;
            --primary-color: #1a73e8;
            --success-color: #1e8e3e;
            --error-color: #d93025;
            --hover-bg: #f8f9fa;
            --input-bg: #f1f3f4;
            --card-bg: #ffffff;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #2d3748;
                --text-color: #e8eaed;
                --subtext-color: #9aa0a6;
                --border-color: #5f6368;
                --primary-color: #8ab4f8;
                --success-color: #81c995;
                --error-color: #f28b82;
                --hover-bg: #3c4043;
                --input-bg: #1f2733;
                --card-bg: #2d3748;
            }
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Inter', sans-serif;
            background-color: transparent;
            overflow-y: auto;
            /* Allow vertical scrolling */
        }

        .widget-wrapper {
            min-height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            /* Changed from center to avoid clipping when scrolling */
            padding: 20px;
            box-sizing: border-box;
        }

        .widget-header {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 10px;
            padding-left: 2px;
        }

        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .phone-input {
            flex: 1;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 1rem;
            color: var(--text-color);
            outline: none;
            transition: border 0.2s, box-shadow 0.2s;
        }

        .phone-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .action-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .action-btn:hover {
            opacity: 0.9;
        }

        .result-card {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            display: none;
            /* Hidden by default */
            flex-direction: column;
            gap: 8px;
        }

        .result-card.visible {
            display: flex;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .label {
            color: var(--subtext-color);
        }

        .value {
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .flag-icon {
            width: 20px;
            height: 15px;
            border-radius: 2px;
            object-fit: cover;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .status-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .status-valid {
            background: rgba(30, 142, 62, 0.1);
            color: var(--success-color);
        }

        .status-invalid {
            background: rgba(217, 48, 37, 0.1);
            color: var(--error-color);
        }

        .formatted-number {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-color);
        }
    </style>
</head>

<body>
    <div class="widget-wrapper">
        <div class="widget-header">Phone No. Formatter</div>

        <div class="input-group">
            <input type="tel" id="phone-input" class="phone-input" placeholder="+1 555 0123" autocomplete="tel">
            <button id="format-btn" class="action-btn">Check</button>
        </div>

        <div id="result-card" class="result-card">
            <div id="formatted-display" class="formatted-number"></div>

            <div class="result-row">
                <span class="label">Country</span>
                <div class="value">
                    <img id="country-flag" class="flag-icon" src="" alt="">
                    <span id="country-name"></span>
                </div>
            </div>

            <div class="result-row" id="region-row" style="display:none;">
                <span class="label">Location</span>
                <span id="region-value" class="value"></span>
            </div>

            <div class="result-row">
                <span class="label">Primary Language</span>
                <span id="language-name" class="value"></span>
            </div>

            <div class="result-row">
                <span class="label">Type</span>
                <span id="number-type" class="value"></span>
            </div>

            <div class="result-row">
                <span class="label">Local Format</span>
                <span id="local-format" class="value"></span>
            </div>
        </div>
    </div>

    <!-- LibPhoneNumber-js from CDN (Max metadata for better type detection) -->
    <script src="https://unpkg.com/libphonenumber-js@1.10.49/bundle/libphonenumber-max.js"></script>
    <script>
        const $ = id => document.getElementById(id);
        const phoneInput = $('phone-input');
        const formatBtn = $('format-btn');
        const resultCard = $('result-card');

        // Simple Country Code to Language mapping (Top countries + generic)
        const countryLanguages = {
            'CN': 'Chinese (简体中文)',
            'TW': 'Chinese (繁體中文)',
            'JP': 'Japanese (日本語)',
            'US': 'English',
            'GB': 'English',
            'AU': 'English',
            'CA': 'English / French',
            'KR': 'Korean (한국어)',
            'FR': 'French',
            'DE': 'German',
            'IT': 'Italian',
            'ES': 'Spanish',
            'BR': 'Portuguese',
            'RU': 'Russian',
            'IN': 'Hindi / English',
            'TH': 'Thai',
            'VN': 'Vietnamese',
            'MY': 'Malay',
            'SG': 'English / Malay / Chinese',
            'ID': 'Indonesian',
            'PH': 'Filipino / English',
            'HK': 'Chinese (Cantonese)',
            // Add more as needed or use a robust library if size permits, but keeping it light for widget.
        };

        const countryNames = new Intl.DisplayNames(['en'], { type: 'region' });

        // Priority countries for domestic format guessing
        const priorityCountries = ['JP', 'CN', 'HK', 'TW', 'KR', 'US'];

        // --- Location Data ---
        // US Area Codes (Simplified Mapping)
        const US_AREA_CODES = {
            '201': 'New Jersey', '202': 'District of Columbia', '203': 'Connecticut', '205': 'Alabama',
            '206': 'Washington', '207': 'Maine', '208': 'Idaho', '209': 'California',
            '210': 'Texas', '212': 'New York', '213': 'California', '214': 'Texas',
            '215': 'Pennsylvania', '216': 'Ohio', '217': 'Illinois', '218': 'Minnesota',
            '219': 'Indiana', '220': 'Ohio', '224': 'Illinois', '225': 'Louisiana',
            '228': 'Mississippi', '229': 'Georgia', '231': 'Michigan', '234': 'Ohio',
            '239': 'Florida', '240': 'Maryland', '248': 'Michigan', '251': 'Alabama',
            '252': 'North Carolina', '253': 'Washington', '254': 'Texas', '256': 'Alabama',
            '260': 'Indiana', '262': 'Wisconsin', '267': 'Pennsylvania', '269': 'Michigan',
            '270': 'Kentucky', '272': 'Pennsylvania', '276': 'Virginia', '281': 'Texas',
            '301': 'Maryland', '302': 'Delaware', '303': 'Colorado', '304': 'West Virginia',
            '305': 'Florida', '307': 'Wyoming', '308': 'Nebraska', '309': 'Illinois',
            '310': 'California', '312': 'Illinois', '313': 'Michigan', '314': 'Missouri',
            '315': 'New York', '316': 'Kansas', '317': 'Indiana', '318': 'Louisiana',
            '319': 'Iowa', '320': 'Minnesota', '321': 'Florida', '323': 'California',
            '325': 'Texas', '330': 'Ohio', '331': 'Illinois', '334': 'Alabama',
            '336': 'North Carolina', '337': 'Louisiana', '339': 'Massachusetts', '340': 'Virgin Islands',
            '346': 'Texas', '347': 'New York', '351': 'Massachusetts', '352': 'Florida',
            '360': 'Washington', '361': 'Texas', '364': 'Kentucky', '380': 'Ohio',
            '385': 'Utah', '386': 'Florida', '401': 'Rhode Island', '402': 'Nebraska',
            '404': 'Georgia', '405': 'Oklahoma', '406': 'Montana', '407': 'Florida',
            '408': 'California', '409': 'Texas', '410': 'Maryland', '412': 'Pennsylvania',
            '413': 'Massachusetts', '414': 'Wisconsin', '415': 'California', '417': 'Missouri',
            '419': 'Ohio', '423': 'Tennessee', '424': 'California', '425': 'Washington',
            '430': 'Texas', '432': 'Texas', '434': 'Virginia', '435': 'Utah',
            '440': 'Ohio', '442': 'California', '443': 'Maryland', '458': 'Oregon',
            '469': 'Texas', '470': 'Georgia', '475': 'Connecticut', '478': 'Georgia',
            '479': 'Arkansas', '480': 'Arizona', '484': 'Pennsylvania', '501': 'Arkansas',
            '502': 'Kentucky', '503': 'Oregon', '504': 'Louisiana', '505': 'New Mexico',
            '507': 'Minnesota', '508': 'Massachusetts', '509': 'Washington', '510': 'California',
            '512': 'Texas', '513': 'Ohio', '515': 'Iowa', '516': 'New York',
            '517': 'Michigan', '518': 'New York', '520': 'Arizona', '530': 'California',
            '531': 'Nebraska', '534': 'Wisconsin', '539': 'Oklahoma', '540': 'Virginia',
            '541': 'Oregon', '551': 'New Jersey', '559': 'California', '561': 'Florida',
            '562': 'California', '563': 'Iowa', '567': 'Ohio', '570': 'Pennsylvania',
            '571': 'Virginia', '573': 'Missouri', '574': 'Indiana', '575': 'New Mexico',
            '580': 'Oklahoma', '585': 'New York', '586': 'Michigan', '601': 'Mississippi',
            '602': 'Arizona', '603': 'New Hampshire', '605': 'South Dakota', '606': 'Kentucky',
            '607': 'New York', '608': 'Wisconsin', '609': 'New Jersey', '610': 'Pennsylvania',
            '612': 'Minnesota', '614': 'Ohio', '615': 'Tennessee', '616': 'Michigan',
            '617': 'Massachusetts', '618': 'Illinois', '619': 'California', '620': 'Kansas',
            '623': 'Arizona', '626': 'California', '628': 'California', '630': 'Illinois',
            '631': 'New York', '636': 'Missouri', '641': 'Iowa', '646': 'New York',
            '650': 'California', '651': 'Minnesota', '657': 'California', '660': 'Missouri',
            '661': 'California', '662': 'Mississippi', '667': 'Maryland', '669': 'California',
            '670': 'Northern Mariana Islands', '671': 'Guam', '678': 'Georgia', '681': 'West Virginia',
            '682': 'Texas', '684': 'American Samoa', '701': 'North Dakota', '702': 'Nevada',
            '703': 'Virginia', '704': 'North Carolina', '706': 'Georgia', '707': 'California',
            '708': 'Illinois', '712': 'Iowa', '713': 'Texas', '714': 'California',
            '715': 'Wisconsin', '716': 'New York', '717': 'Pennsylvania', '718': 'New York',
            '719': 'Colorado', '720': 'Colorado', '724': 'Pennsylvania', '725': 'Nevada',
            '727': 'Florida', '731': 'Tennessee', '732': 'New Jersey', '734': 'Michigan',
            '737': 'Texas', '740': 'Ohio', '747': 'California', '754': 'Florida',
            '757': 'Virginia', '760': 'California', '762': 'Georgia', '763': 'Minnesota',
            '765': 'Indiana', '769': 'Mississippi', '770': 'Georgia', '772': 'Florida',
            '773': 'Illinois', '774': 'Massachusetts', '775': 'Nevada', '779': 'Illinois',
            '781': 'Massachusetts', '785': 'Kansas', '786': 'Florida', '787': 'Puerto Rico',
            '801': 'Utah', '802': 'Vermont', '803': 'South Carolina', '804': 'Virginia',
            '805': 'California', '806': 'Texas', '808': 'Hawaii', '810': 'Michigan',
            '812': 'Indiana', '813': 'Florida', '814': 'Pennsylvania', '815': 'Illinois',
            '816': 'Missouri', '817': 'Texas', '818': 'California', '828': 'North Carolina',
            '830': 'Texas', '831': 'California', '832': 'Texas', '843': 'South Carolina',
            '845': 'New York', '847': 'Illinois', '848': 'New Jersey', '850': 'Florida',
            '856': 'New Jersey', '857': 'Massachusetts', '858': 'California', '859': 'Kentucky',
            '860': 'Connecticut', '862': 'New Jersey', '863': 'Florida', '864': 'South Carolina',
            '865': 'Tennessee', '870': 'Arkansas', '872': 'Illinois', '878': 'Pennsylvania',
            '901': 'Tennessee', '903': 'Texas', '904': 'Florida', '906': 'Michigan',
            '907': 'Alaska', '908': 'New Jersey', '909': 'California', '910': 'North Carolina',
            '912': 'Georgia', '913': 'Kansas', '914': 'New York', '915': 'Texas',
            '916': 'California', '917': 'New York', '918': 'Oklahoma', '919': 'North Carolina',
            '920': 'Wisconsin', '925': 'California', '928': 'Arizona', '929': 'New York',
            '931': 'Tennessee', '936': 'Texas', '937': 'Ohio', '938': 'Alabama',
            '939': 'Puerto Rico', '940': 'Texas', '941': 'Florida', '947': 'Michigan',
            '949': 'California', '951': 'California', '952': 'Minnesota', '954': 'Florida',
            '956': 'Texas', '959': 'Connecticut', '970': 'Colorado', '971': 'Oregon',
            '972': 'Texas', '973': 'New Jersey', '978': 'Massachusetts', '979': 'Texas',
            '980': 'North Carolina', '984': 'North Carolina', '985': 'Louisiana', '989': 'Michigan'
        };

        // China Landline Area Codes (Major Cities)
        const CN_AREA_CODES = {
            '10': 'Beijing (北京)', '20': 'Guangzhou (广州)', '21': 'Shanghai (上海)',
            '22': 'Tianjin (天津)', '23': 'Chongqing (重庆)', '24': 'Shenyang (沈阳)',
            '25': 'Nanjing (南京)', '27': 'Wuhan (武汉)', '28': 'Chengdu (成都)', '29': 'Xi\'an (西安)',
            '755': 'Shenzhen (深圳)', '757': 'Foshan (佛山)', '769': 'Dongguan (东莞)',
            '571': 'Hangzhou (杭州)', '512': 'Suzhou (苏州)', '532': 'Qingdao (青岛)',
            '592': 'Xiamen (厦门)', '411': 'Dalian (大连)', '574': 'Ningbo (宁波)'
        };

        // China Mobile Carrier Prefixes
        const CN_CARRIERS = {
            '134': 'China Mobile', '135': 'China Mobile', '136': 'China Mobile', '137': 'China Mobile',
            '138': 'China Mobile', '139': 'China Mobile', '147': 'China Mobile', '150': 'China Mobile',
            '151': 'China Mobile', '152': 'China Mobile', '157': 'China Mobile', '158': 'China Mobile',
            '159': 'China Mobile', '172': 'China Mobile', '178': 'China Mobile', '182': 'China Mobile',
            '183': 'China Mobile', '184': 'China Mobile', '187': 'China Mobile', '188': 'China Mobile',
            '195': 'China Mobile', '197': 'China Mobile', '198': 'China Mobile',

            '130': 'China Unicom', '131': 'China Unicom', '132': 'China Unicom', '145': 'China Unicom',
            '155': 'China Unicom', '156': 'China Unicom', '166': 'China Unicom', '175': 'China Unicom',
            '176': 'China Unicom', '185': 'China Unicom', '186': 'China Unicom', '196': 'China Unicom',

            '133': 'China Telecom', '149': 'China Telecom', '153': 'China Telecom', '173': 'China Telecom',
            '177': 'China Telecom', '180': 'China Telecom', '181': 'China Telecom', '189': 'China Telecom',
            '190': 'China Telecom', '191': 'China Telecom', '193': 'China Telecom', '199': 'China Telecom'
        };

        // Partial H-Code Map (First 3 digits prefix + next 4 digits) -> Location
        // Mobile number structure: 1xx (3) + xxxx (4) + xxxx (4)
        // Key: First 7 digits
        const CN_HCODE_MAP = {
            '1503358': 'Hebei Qinhuangdao (河北 秦皇岛)',
            // Common Beijing
            '1391000': 'Beijing (北京)', '1380013': 'Beijing (北京)',
            // Common Shanghai
            '1390162': 'Shanghai (上海)',
            // Add more sample data or explain limitation
        };

        let candidates = [];
        let currentCandidateIndex = 0;

        function getRegionInfo(pn) {
            const country = pn.country;
            const national = pn.nationalNumber; // Raw digits without country code

            if (country === 'US') {
                const areaCode = national.substring(0, 3);
                return US_AREA_CODES[areaCode] || null;
            }

            if (country === 'CN') {
                // Fixed Line
                const ac2 = national.substring(0, 2);
                if (CN_AREA_CODES[ac2]) return CN_AREA_CODES[ac2];
                const ac3 = national.substring(0, 3);
                if (CN_AREA_CODES[ac3]) return CN_AREA_CODES[ac3];

                // Mobile
                const prefix = national.substring(0, 3);
                const hcode = national.substring(0, 7);

                let carrier = CN_CARRIERS[prefix] || '';
                let location = CN_HCODE_MAP[hcode] || '';

                // If we don't have exact location, checking generic logic or just returning Carrier
                if (location && carrier) {
                    return `${location} - ${carrier}`;
                } else if (location) {
                    return location;
                } else if (carrier) {
                    return `China (${carrier})`;
                }
            }

            return null;
        }

        function formatPhoneNumber() {
            let raw = phoneInput.value.trim();
            if (!raw) {
                hideResult();
                return;
            }

            candidates = [];
            currentCandidateIndex = 0;
            const seen = new Set();

            // Helper to add unique valid numbers
            const addCandidate = (pn) => {
                if (pn && pn.isValid()) {
                    const key = `${pn.country}-${pn.number}`; // Unique by country + E.164
                    if (!seen.has(key)) {
                        candidates.push(pn);
                        seen.add(key);
                    }
                }
            };

            // Strategy 1: Attempt standard international parsing
            try {
                addCandidate(libphonenumber.parsePhoneNumber(raw));
            } catch (e) { }

            // Strategy 2: Prepend '+' (Treat as strict international)
            if (!raw.startsWith('+')) {
                try {
                    addCandidate(libphonenumber.parsePhoneNumber('+' + raw));
                } catch (e) { }
            }

            // Strategy 3: Iterate through priority countries for domestic interpretation
            for (const country of priorityCountries) {
                try {
                    // Start with priority countries to catch domestic formats
                    addCandidate(libphonenumber.parsePhoneNumber(raw, country));
                } catch (e) { }
            }

            // Fallback for "invalid but let's show something" logic
            // Only if NO valid candidates found
            if (candidates.length === 0) {
                // Try loose parsing again just to show raw info
                let fallback = null;
                try {
                    fallback = libphonenumber.parsePhoneNumber(raw);
                } catch (e) { }

                if (!fallback && !raw.startsWith('+')) {
                    try { fallback = libphonenumber.parsePhoneNumber('+' + raw); } catch (e) { }
                }

                // If absolutely nothing, just raw
                if (!fallback) {
                    showRawInfo(raw);
                    return;
                }
                // If invalid but parsed, show it
                displayResult(fallback, raw, false);
                return;
            }

            // We have valid candidates.
            // Sort logic? Maybe preserve order but heuristic:
            // If raw starts with '+', international interpretation should be first (already pushed first).
            // If raw doesn't start with '+', domestic interpretation might be preferred?
            // Current order: Intl (strategy 1/2), then Domestic (strategy 3).
            // For "1503...", Strategy 2 (+1503...) finds US. Strategy 3 (CN domestic) finds CN.
            // So US will be first in array.

            // Render primary
            renderCurrentCandidate(raw);
        }

        function renderCurrentCandidate(raw) {
            const pn = candidates[currentCandidateIndex];
            displayResult(pn, raw, true);
        }

        function displayResult(phoneNumber, rawInput, isValidCandidate) {
            try {
                const country = phoneNumber.country;
                const formatIntl = phoneNumber.formatInternational();
                const formatNational = phoneNumber.formatNational();
                const type = phoneNumber.getType();

                // Update UI
                $('formatted-display').textContent = formatIntl || (rawInput.startsWith('+') ? rawInput : '+' + rawInput);
                $('local-format').textContent = formatNational || '-';

                if (country) {
                    $('country-flag').src = `https://flagcdn.com/w40/${country.toLowerCase()}.png`;
                    $('country-flag').style.display = 'block';
                    try {
                        $('country-name').textContent = countryNames.of(country);
                    } catch (e) {
                        $('country-name').textContent = country;
                    }
                    $('language-name').textContent = countryLanguages[country] || 'Unknown';
                } else {
                    $('country-flag').style.display = 'none';
                    $('country-name').textContent = 'Unknown Region';
                    $('language-name').textContent = '-';
                }

                $('number-type').textContent = type ? type.replace('_', ' ').toLowerCase().replace(/\b\w/g, l => l.toUpperCase()) : 'Unknown';

                // Look up Region
                const region = getRegionInfo(phoneNumber);
                const regionRow = $('region-row');
                const regionVal = $('region-value');
                if (region) {
                    regionVal.textContent = region;
                    regionRow.style.display = 'flex';
                } else {
                    regionRow.style.display = 'none';
                }

                // Render Alternatives
                renderAlternatives();

                resultCard.classList.add('visible');

            } catch (error) {
                console.error(error);
                showRawInfo(rawInput);
            }
        }

        function renderAlternatives() {
            // Remove existing alternatives container if any
            let altContainer = $('alternatives-container');
            if (altContainer) {
                altContainer.innerHTML = '';
            } else {
                altContainer = document.createElement('div');
                altContainer.id = 'alternatives-container';
                altContainer.className = 'result-row';
                altContainer.style.marginTop = '8px';
                altContainer.style.justifyContent = 'flex-start';
                altContainer.style.flexWrap = 'wrap';
                altContainer.style.gap = '8px';
                resultCard.appendChild(altContainer);
            }

            if (candidates.length > 1) {
                const label = document.createElement('span');
                label.className = 'label';
                label.style.width = '100%';
                label.textContent = 'Alternatives:';
                altContainer.appendChild(label);

                candidates.forEach((cand, idx) => {
                    if (idx === currentCandidateIndex) return;

                    const btn = document.createElement('button');
                    btn.className = 'status-badge'; // Reuse badge style for buttons
                    btn.style.cursor = 'pointer';
                    btn.style.border = '1px solid var(--border-color)';
                    btn.style.background = 'var(--bg-color)';
                    btn.style.color = 'var(--text-color)';
                    btn.style.display = 'flex';
                    btn.style.alignItems = 'center';
                    btn.style.gap = '4px';

                    const flag = document.createElement('img');
                    flag.className = 'flag-icon';
                    flag.style.width = '16px';
                    flag.style.height = '12px';
                    if (cand.country) {
                        flag.src = `https://flagcdn.com/w40/${cand.country.toLowerCase()}.png`;
                    }

                    const text = document.createElement('span');
                    // Short text: Country + Type ?
                    text.textContent = cand.country || '?';

                    btn.appendChild(flag);
                    btn.appendChild(text);

                    btn.onclick = () => {
                        currentCandidateIndex = idx;
                        renderCurrentCandidate(phoneInput.value.trim());
                    };

                    altContainer.appendChild(btn);
                });
            }
        }

        function showRawInfo(raw) {
            $('formatted-display').textContent = raw;
            $('local-format').textContent = '-';
            $('country-name').textContent = '-';
            $('language-name').textContent = '-';
            $('number-type').textContent = '-';
            $('country-flag').style.display = 'none';
            const alt = $('alternatives-container');
            if (alt) alt.innerHTML = '';
            const rr = $('region-row');
            if (rr) rr.style.display = 'none';
            resultCard.classList.add('visible');
        }

        function hideResult() {
            resultCard.classList.remove('visible');
        }

        formatBtn.addEventListener('click', formatPhoneNumber);

        phoneInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') formatPhoneNumber();
        });

    </script>
</body>

</html>